# Boost-Search

## 项目简介

---

这是一个对接Boost官网的站内搜索引擎。支持根据关键词检索boost官网中对应语法的网页。

#### 依赖的第三方库

- `boost`
- `cppjieba`
- `gflags`
- `glog`
- `protobuf`
- `sofa-pbrpc`
- `ctemplate`

## 项目描述

---

这个项目可以分为四个半模块：

#### 公共模块

> 这就是那半个模块~

为了让程序尽可能的实现解耦和，把一些其他模块都用到的或者和具体业务无关的函数以header-only的形式封装成一个头文件，其他模块要用其中函数直接包含头文件就可以使用。其中包含的功能有：

- 字符串无损切割；
- 暂停词的加载和查找；
- 指定形式的读/写文件；
- 获取当前句句首位置；
- 时间戳的获取。

#### 索引模块

- 提供预处理功能。先将从boost网站下载的站内HTML格式数据处理成`url+title+content`格式，每一个网页占一行存储在一个文件中。

- 提供索引文件的制作方法。读取处理后的网站数据，对每一个网页的标题和正文使用`cppjieba`进行分词然后制作成正排索引和倒排索引结构再经过`protobuf`压缩后写入磁盘文件中。这里在制作倒排索引的时候对文本相似度的计算从简考虑，网页权值计算公式：
  $$
  Weight =TitleCount * 10 + ContentCount
  $$

- 提供从磁盘文件读取并在内存中还原出索引结构的方法。
- 提供倒排索引的查询方法，通过给定的关键词，可以获取到和关键词相关的文档列表。
- 提供正排索引的查询方法，通过从倒排索引中查找出的文档id，可以获取倒文档的详细信息。

#### 搜索服务器模块

将搜索客户端发来的查询词用`cppjieba`进行分词并且去掉其中的暂停词，然后对分词结果进行触发，即从倒排索引中找到所有的倒排列表。经过相似度计算得出网页权值，然后对这些倒排列表进行一个综合的排序，根据排序后的倒排列表从正排索引中找到对应的网页的详细信息，并对倒排列表中的每个网页生成对应的描述信息，然后调用`ctemplate`将这些封装成搜索结果页面发送给搜索客户端。

#### 搜索客户端模块

这个模块作为CGI程序与HTTP服务器模块进行交互，通过RPC框架和搜索服务器模块进行交互。这个模块需要做的工作比较简单，就是读取HTTP服务器模块创建的环境变量QUERY_STRING并解析出浏览器发送的查询词，然后通过RPC框架调用搜索服务器进行搜索，然后将搜索结果通过管道转发给HTTP服务器模块。

#### HTTP服务器模块

这个模块用Ç语言实现，可以对浏览器发送的HTTP请求中的GET方法和POST方法进行响应，静态页面通过封装完整的HTTP响应报文，读取服务器（此服务器指物理意义上的服务器）上的静态资源作为HTTP响应的body部分，然后将HTTP响应报文发送回浏览器，由浏览器加载；动态页面根据CGI协议，创建子进程进行进程替换执行CGI模块业务逻辑，父进程读取子进程写入管道的数据作为HTTP响应报文的body部分，接着封装完整的HTTP响应报文，然后将其发送给浏览器。

## 演示截图

---

![search_image](https://github.com/fenshitianyue/Boost-Search/blob/master/images/search_image.jpg)

![search_image_result](https://github.com/fenshitianyue/Boost-Search/blob/master/images/search_result_image.jpg)

## 关于作者

- Email: `yaoaobo@foxmail.com`
- QQ: `1262167092`
- Blog: <https://blog.csdn.net/zanda_>